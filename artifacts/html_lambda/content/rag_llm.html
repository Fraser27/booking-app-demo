<!DOCTYPE html>
<!-- saved from url=(0062)https://5fzlbtf429.execute-api.us-east-1.amazonaws.com/dev/rag -->
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
    crossorigin="anonymous"></script>


</head>

<body>
  <center>
    <h1>Llama2-7b with Opensearch Serverless vector db demo</h1>
  </center>




  <div id="err"></div>
  <table>
    <tbody>
      <tr>
        <th>Index Documents</th>
        <th style="padding-left: 100px;"></th>
        <th>Response</th>
      </tr>
      <tr>
        <td>
          <div>
            <textarea placeholder="Add text here for indexing. Limit to 100 characters" id="index_txt" name="request"
              rows="10" cols="60"></textarea>
          </div>
        </td>
        <td style="padding-left: 0px;"></td>
        <td>
          <div>
            <textarea id="response" name="response" rows="10" cols="60" readonly=""></textarea>
          </div>
        </td>
      </tr>
      <tr>

      </tr>


    </tbody>
  </table>

  <div class="d-flex justify-content-center" id="custom-spinner">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

  <div id="sse">
    <table>
      <tbody>
        <tr>
          <td style="padding-left: 20px;">
            <div id="index-button"><a href="javascript:indexDocuments()">Index Documents</a></div>
          </td>
          <td style="padding-left: 20px;">
            <div id="delete-button"><a href="javascript:reset()">Delete Index</a></div>
          </td>
          <td style="padding-left: 20px;">

          </td>

        </tr>

      </tbody>
    </table>
    <div style="padding-bottom: 20px;"></div>
    <div style="padding-left: 10px;"><input style="width: 34vw;" placeholder="Query your data here" id="query"
        type="text"></div>
    <div style="padding-bottom: 10px;"></div>
    <div id="query-button" style="padding-left: 10px;"><a href="javascript:query()">Query data</a></div>
    
    <div>
      <table>
        <th>Sample Questions</th>
        <tr><td><i>Find out about this new disease FrostFlu</i></td></tr>
        <tr><td><i>Find out about this new movie 'Enigma's Pursuit'</i></td></tr>
        <tr><td><i>Find out about the schools near Tata Serien</i></td></tr>
      </table>



    </div>

  </div>


  <footer>
    <script type="text/javascript">
      // do stuff
      $(document).ready(function () {
        $('#custom-spinner').css('visibility','hidden');

      });

      var awsData = {
          apiGatewayUrl: '<apiGatewayUrl>',
          staticPageUrl: '<apiGatewayUrl>'
      };

      function indexDocuments() {

        $('#custom-spinner').css('visibility','visible');
        $('#index-button').css('visibility','hidden');
        $('#query-button').css('visibility','hidden');
        $('#delete-button').css('visibility','hidden');
        //Retrieve list of dashboards that the user can access from QuickSight.
        $.ajax({
          type: "POST",
          url: awsData.apiGatewayUrl + '/index-documents',
          contentType: "text/json",
          dataType: 'json',
          data: JSON.stringify({ "text": $('#index_txt').val() }),
          success: function (result) {
            $('#custom-spinner').css('visibility','hidden');
            $('#index-button').css('visibility','visible');
            $('#query-button').css('visibility','visible');
            $('#delete-button').css('visibility','visible');
            $('#response').val(result['result'])
          },
          error: function (err) {
            $('#custom-spinner').css('visibility','hidden');
            $('#index-button').css('visibility','visible');
            $('#query-button').css('visibility','visible');
            $('#delete-button').css('visibility','visible');
            console.log('Error on making API gateway call to index documents ..');
            console.log(err.responseText);
            $('#response').html(err.responseText.replaceAll('"', ''));
          }
        });
      }


      function reset() {
        $('#custom-spinner').css('visibility','visible');
        $('#index-button').css('visibility','hidden');
        $('#query-button').css('visibility','hidden');
        $('#delete-button').css('visibility','hidden');
        $.ajax({
          type: "DELETE",
          url: awsData.apiGatewayUrl + '/index-documents',
          contentType: "text/json",
          dataType: 'json',
          success: function (result) {
            $('#response').val(result['result'])
            $('#custom-spinner').css('visibility','hidden');
            $('#index-button').css('visibility','visible');
            $('#query-button').css('visibility','visible');
            $('#delete-button').css('visibility','visible');
          },
          error: function (err) {
            $('#custom-spinner').css('visibility','hidden');
            $('#index-button').css('visibility','visible');
            $('#query-button').css('visibility','visible');
            $('#delete-button').css('visibility','visible');
            console.log('Error on making API gateway call to delete index..');
            console.log(err.responseText);
            $('#response').html(err.responseText.replaceAll('"', ''));
          }
        });

      }



      function query() {
        $('#custom-spinner').css('visibility','visible');
        $('#index-button').css('visibility','hidden');
        $('#query-button').css('visibility','hidden');
        $('#delete-button').css('visibility','hidden');
        $.ajax({
          url: awsData.apiGatewayUrl + '/query?query=' + $('#query').val(),
          contentType: "text/json",
          dataType: 'json',
          success: function (result) {
            $('#response').val(result['result'][0]['Assistant'])
            $('#custom-spinner').css('visibility','hidden');
            $('#index-button').css('visibility','visible');
            $('#query-button').css('visibility','visible');
            $('#delete-button').css('visibility','visible');
          },
          error: function (err) {
            $('#custom-spinner').css('visibility','hidden');
            $('#index-button').css('visibility','visible');
            $('#query-button').css('visibility','visible');
            $('#delete-button').css('visibility','visible');
            console.log('Error on making API gateway call to retrieve Dashboard list..');
            console.log(err.responseText);
            err_msg = err.responseText + " . Have you indexed documents ?"
            $('#response').html(err_msg.replaceAll('"', ''));
          }
        });

      }

    </script>


  </footer>

</body>

</html>